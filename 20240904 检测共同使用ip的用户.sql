
-- env: hadoop 3.1.4 + hive 3.1.3

--==============================================================
-- data requirement
--==============================================================
-- input
-- a       124     2019-08-07 13:0:0
-- b       124     2019-08-08 12:0:0
-- c       124     2019-08-09 12:0:0
-- a       124     2019-08-07 12:0:0
-- a       174     2019-08-10 12:0:0
-- b       174     2019-08-11 12:0:0
-- a       194     2019-08-12 12:0:0
-- b       194     2019-08-13 13:0:0
-- c       174     2019-08-14 12:0:0
-- c       194     2019-08-15 12:0:0

-- target 
-- 
--==============================================================

--==============================================================
-- create base table
create table base (
    u_id string,
    ip string,
    login_ip string
);
insert into base values('a', '124', '2019-08-07 13:0:0'),
    ('b', '124', '2019-08-08 12:0:0'),
    ('c', '124', '2019-08-09 12:0:0'),
    ('a', '124', '2019-08-07 12:0:0'),
    ('a', '174', '2019-08-10 12:0:0'),
    ('b', '174', '2019-08-11 12:0:0'),
    ('a', '194', '2019-08-12 12:0:0'),
    ('b', '194', '2019-08-13 13:0:0'),
    ('c', '174', '2019-08-14 12:0:0'),
    ('c', '194', '2019-08-15 12:0:0');
--==============================================================

--==============================================================
-- solution n: desc
with pre as (
    select 
        ip, uid_list
    from (
        select
            ip, u_id
        from base
        group by ip, u_id
    ) t
    where diff_cnt_uid >= 3
)
select * from pre
-- key points:
-- desc

-- output:
--==============================================================

